---
interface Props {
  videoId: string;
  platform?: 'vimeo' | 'youtube';
  title: string;
  thumbnail: string;
}

const { videoId, platform = 'vimeo', title, thumbnail } = Astro.props;

const embedUrl = platform === 'vimeo'
  ? `https://player.vimeo.com/video/${videoId}?autoplay=1&title=0&byline=0&portrait=0`
  : `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1`;
---

<div class="video-embed" data-embed-url={embedUrl}>
  <div class="video-embed__facade">
    <img src={thumbnail} alt={`Thumbnail for ${title}`} loading="lazy" />
    <button class="video-embed__play" aria-label={`Play ${title}`} data-cursor-hover>
      <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="24" cy="24" r="23" stroke="currentColor" stroke-width="1.5"/>
        <path d="M19 15l14 9-14 9V15z" fill="currentColor"/>
      </svg>
    </button>
  </div>
</div>

<style>
  .video-embed {
    position: relative;
    aspect-ratio: 16 / 9;
    background: var(--color-surface);
    overflow: hidden;
  }

  .video-embed__facade {
    width: 100%;
    height: 100%;
    position: relative;
  }

  .video-embed__facade img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition-smooth);
  }

  .video-embed:hover .video-embed__facade img {
    transform: scale(1.03);
  }

  .video-embed__play {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 64px;
    height: 64px;
    color: var(--color-text);
    transition: color var(--transition-fast), transform var(--transition-fast);
  }

  .video-embed__play:hover {
    color: var(--color-accent);
    transform: translate(-50%, -50%) scale(1.1);
  }

  .video-embed__play svg {
    width: 100%;
    height: 100%;
  }

  .video-embed :global(iframe) {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }
</style>

<script>
  function initFacades() {
    document.querySelectorAll('.video-embed').forEach((embed) => {
      const playBtn = embed.querySelector('.video-embed__play');
      if (!playBtn) return;

      playBtn.addEventListener('click', () => {
        const url = embed.getAttribute('data-embed-url');
        if (!url) return;
        const iframe = document.createElement('iframe');
        iframe.src = url;
        iframe.allow = 'autoplay; fullscreen; picture-in-picture';
        iframe.setAttribute('allowfullscreen', '');
        iframe.setAttribute('title', 'Video player');
        const facade = embed.querySelector('.video-embed__facade');
        if (facade) facade.replaceWith(iframe);
      });
    });
  }

  initFacades();
  document.addEventListener('astro:after-swap', initFacades);
</script>
