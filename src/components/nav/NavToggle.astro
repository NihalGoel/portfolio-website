---
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/work', label: 'Work' },
  { href: '/film', label: 'Film' },
  { href: '/about', label: 'About' },
  { href: '/contact', label: 'Contact' },
];

const currentPath = Astro.url.pathname;
---

<!-- Mobile bottom bar + fullscreen overlay -->
<div class="mobile-nav" id="mobile-nav">
  <button
    class="mobile-nav__bar"
    id="mobile-nav-toggle"
    aria-expanded="false"
    aria-controls="mobile-nav-overlay"
    aria-label="Open navigation menu"
  >
    <span class="mobile-nav__bar-line"></span>
  </button>

  <div class="mobile-nav__overlay" id="mobile-nav-overlay" aria-hidden="true">
    <ul class="mobile-nav__links">
      {navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            class:list={['mobile-nav__link', { 'is-active': currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) }]}
          >
            {link.label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</div>

<style>
  .mobile-nav {
    display: none;
  }

  @media (max-width: 768px) {
    .mobile-nav {
      display: block;
    }

    .mobile-nav__bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1001;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(10, 10, 10, 0.9);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(232, 228, 223, 0.08);
    }

    .mobile-nav__bar-line {
      display: block;
      width: 40px;
      height: 2px;
      background: var(--color-accent);
      border-radius: 1px;
      transition: transform var(--transition-fast);
    }

    .mobile-nav__bar[aria-expanded='true'] .mobile-nav__bar-line {
      transform: rotate(45deg);
    }

    .mobile-nav__overlay {
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: rgba(10, 10, 10, 0.97);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-smooth), visibility var(--transition-smooth);
    }

    .mobile-nav__overlay.is-open {
      opacity: 1;
      visibility: visible;
    }

    .mobile-nav__links {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
    }

    .mobile-nav__link {
      font-family: var(--font-display);
      font-size: 2rem;
      opacity: 0.6;
      transition: opacity var(--transition-fast);
    }

    .mobile-nav__link:hover,
    .mobile-nav__link.is-active {
      opacity: 1;
    }

    .mobile-nav__link.is-active {
      color: var(--color-accent);
    }
  }
</style>

<script>
  function initMobileNav() {
    const toggle = document.getElementById('mobile-nav-toggle');
    const overlay = document.getElementById('mobile-nav-overlay');
    if (!toggle || !overlay) return;

    toggle.addEventListener('click', () => {
      const expanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', String(!expanded));
      toggle.setAttribute('aria-label', expanded ? 'Open navigation menu' : 'Close navigation menu');
      overlay.classList.toggle('is-open');
      overlay.setAttribute('aria-hidden', String(expanded));
      document.body.style.overflow = expanded ? '' : 'hidden';
    });

    // Close on link click
    overlay.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        toggle.setAttribute('aria-expanded', 'false');
        toggle.setAttribute('aria-label', 'Open navigation menu');
        overlay.classList.remove('is-open');
        overlay.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      });
    });
  }

  initMobileNav();
  document.addEventListener('astro:after-swap', initMobileNav);
</script>
